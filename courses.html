<script>
  function getCategory(item) {
    const i = item.toLowerCase().trim();

    // ðŸŽ Fruits
    const fruits = [
      "pomme","banane","framboise","kiwi","raisin","raisins secs",
      "mangue","mandarine","baies","fruit","fruits"
    ];
    if (fruits.some(w => i.includes(w))) return "ðŸŽ Fruits";

    // ðŸ¥¬ LÃ©gumes
    const legumes = [
      "carotte","carottes","courgette","courgettes","poivron","poivrons",
      "betterave","betteraves","salade","laitue","avocat","aubergine",
      "aubergines","epinard","epinards","haricot","haricots","chou",
      "asperge","asperges","legume","legumes","tomate","tomates",
      "patate douce","patates douces","champignon","champignons"
    ];
    if (legumes.some(w => i.includes(w))) return "ðŸ¥¬ LÃ©gumes";

    // ðŸ— ProtÃ©ines
    const proteines = [
      "poulet","saumon","crevette","crevettes","boeuf","dinde",
      "oeuf","oeufs","yaourt","tofu"
    ];
    if (proteines.some(w => i.includes(w))) return "ðŸ— ProtÃ©ines";

    // ðŸ¥› Laitages chÃ¨vre/brebis
    const laitages = [
      "chevre","brebis","fromage"
    ];
    if (laitages.some(w => i.includes(w))) return "ðŸ¥› Laitages chÃ¨vre/brebis";

    // ðŸ¥£ Placard
    const placard = [
      "riz","quinoa","chia","amandes","noix","beurre","pain",
      "huile","vinaigre","hummus","guacamole"
    ];
    if (placard.some(w => i.includes(w))) return "ðŸ¥£ Placard";

    return "ðŸ§‚ Divers";
  }

  fetch("data/courses.json?cache=" + Date.now())
    .then(r => r.json())
    .then(list => {
      const container = document.getElementById("courses-container");
      container.innerHTML = "";

      const grouped = {};

      list.forEach(item => {
        const cat = getCategory(item);
        if (!grouped[cat]) grouped[cat] = [];
        grouped[cat].push(item);
      });

      for (const cat in grouped) {
        container.innerHTML += `<div class="category">${cat}</div>`;
        grouped[cat].forEach(item => {
          container.innerHTML += `
            <div class="item">
              <input type="checkbox" id="${item}">
              <label for="${item}">${item}</label>
            </div>`;
        });
      }
    })
    .catch(err => {
      document.getElementById("courses-container").innerHTML =
        "<p>Impossible de charger la liste.</p>";
      console.error(err);
    });
</script>
