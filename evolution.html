<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“Š Ã‰volution corporelle â€“ The Safe Place Universe</title>
  <link rel="stylesheet" href="style-v2.css">

  <style>
    /* ğŸ€ Harmonisation du tableau */
    #progressTable {
      width: 100%;
      border-collapse: collapse;
      background: var(--blanc);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0,0,0,0.05);
      margin-top: 1.2rem;
    }

    #progressTable th {
      background-color: var(--pÃªche);
      color: var(--texte);
      font-weight: 600;
      padding: 0.8rem;
      text-align: center;
      font-size: 1rem;
    }

    #progressTable td {
      padding: 0.6rem;
      text-align: center;
      border-bottom: 1px solid #f3e7f5;
    }

    #progressTable tr:last-child td {
      border-bottom: none;
    }

    #progressTable input {
      width: 85%;
      padding: 0.4rem 0.6rem;
      border: 1px solid var(--lavande);
      border-radius: 10px;
      background: #fff9fb;
      text-align: center;
      font-family: 'Quicksand', sans-serif;
      transition: all 0.2s ease;
    }

    #progressTable input:focus {
      outline: none;
      border-color: var(--accent);
      background: #fff;
      box-shadow: 0 0 5px rgba(240,184,202,0.4);
    }

    canvas {
      display: block;
      margin: 1.5rem auto;
      max-width: 600px;
    }

    .mantra {
      font-style: italic;
      text-align: center;
      color: var(--accent);
      margin-bottom: 1rem;
    }
  </style>

  <!-- Charger Chart.js AVANT ton script -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <section class="splash">
    <h1>ğŸ“Š Ã‰volution corporelle</h1>
    <p class="subtitle">Suis ton Ã©volution en douceur, mois aprÃ¨s mois ğŸŒ·</p>
  </section>

  <main class="content">

    <div class="card">
      <h2>ğŸŒ¸ Suivi mensuel</h2>
      <p class="mantra">â€œChaque progrÃ¨s, mÃªme minime, est une victoire.â€ ğŸ’ª</p>

      <table id="progressTable">
        <thead>
          <tr>
            <th>Mois</th>
            <th>Poids (kg)</th>
            <th>Taille (cm)</th>
            <th>Poitrine (cm)</th>
            <th>Hanche (cm)</th>
            <th>Bras (cm)</th>
            <th>Cuisse (cm)</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Janvier</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>FÃ©vrier</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>Mars</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>Avril</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>Mai</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>Juin</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>Juillet</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>AoÃ»t</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>Septembre</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>Octobre</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>Novembre</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          <tr><td>DÃ©cembre</td><td><input class="poids"></td><td><input></td><td><input></td><td><input></td><td><input></td><td><input></td></tr>
        </tbody>
      </table>
    </div>

    <div class="card">
      <h2>ğŸ“ˆ Courbe dâ€™Ã©volution du poids</h2>
      <canvas id="weightChart"></canvas>
    </div>

    <nav class="menu">
      <a href="index.html">ğŸ¡ Retour Ã  lâ€™accueil</a>
    </nav>
  </main>


  <!-- ğŸ€ SCRIPT FINAL 100% FONCTIONNEL -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {

      const chartCanvas = document.getElementById("weightChart");
      let chart = null;

      const inputs = document.querySelectorAll("#progressTable input");
      const saved = JSON.parse(localStorage.getItem("bodyProgress")) || {};

      // Charger sauvegarde
      inputs.forEach((input, i) => {
        input.value = saved[i] || "";
        input.addEventListener("input", () => {
          saved[i] = input.value;
          localStorage.setItem("bodyProgress", JSON.stringify(saved));
          updateChart();
        });
      });

      function updateChart() {
        const months = ["Jan", "FÃ©v", "Mar", "Avr", "Mai", "Juin", "Juil", "AoÃ»t", "Sep", "Oct", "Nov", "DÃ©c"];
        const weights = [];

        // lire la colonne Poids = cellule index 1
        document.querySelectorAll("#progressTable tbody tr").forEach(row => {
          const val = parseFloat(row.cells[1].querySelector("input").value);
          weights.push(Number.isFinite(val) ? val : null);
        });

        // DÃ©truire l'ancien graphique si besoin
        if (chart && typeof chart.destroy === "function") {
          chart.destroy();
        }

        // CrÃ©er nouveau graphique
        chart = new Chart(chartCanvas, {
          type: "line",
          data: {
            labels: months,
            datasets: [{
              label: "Poids (kg)",
              data: weights,
              borderColor: "#f0b8ca",
              tension: 0.3,
              pointBackgroundColor: "#d16ba5",
              pointRadius: 5
            }]
          },
          options: {
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: false }
            }
          }
        });
      }

      updateChart();
    });
  </script>

</body>
</html>
